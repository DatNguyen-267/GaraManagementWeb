<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/pay.css">

<div class="grid__item">
    <div class="header">
    <div class="header__link">Tiếp nhận xe > Thanh toán</div>
</div>
<div class="container">
    <div class="bill">
        <div class="bill__header">
            <div class="bill__header-name">Hóa đơn thanh toán</div>
            <div class="bill__header-company-name">Nhà xe: DGara</div>
            <div class="bill__header-phone">Địa chỉ: Khu phố 6, Thủ Đức, Thành phố Hồ Chí Minh</div>
            <div class="bill__header-phone">SDT: 096964451</div>
        </div>
        <div class="bill__customer-info">
            <div class="info-group">
                <label for="">Tên khách hàng:</label>
                <label >{{Reception.of_customer.name}}</label>
            </div>
            <div class="info-group">
                <label for="">Biển số xe:</label>
                <label >{{Reception.license}}</label>
            </div>
            <div class="info-group">
                <label for="">Phone:</label>
                <label >{{Reception.of_customer.phone}}</label>
            </div>
            <div class="info-group">
                <label for="">Ngày lập phiếu:</label>
                <label >{{Now}}</label>
            </div>
        </div>
        <div class="bill__repair-info">
            <div class="bill__repair-info__table-material">
                <table class="table" style="overflow-y:scroll">
                <thead>
                    <tr>
                        <th scope="col">Nội dung</th>
                        <th scope="col">Tên vật tư</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Đơn giá</th>
                        <th scope="col">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each DetailMaterial}}
                    <tr>
                        <td scope="row">{{this.content}}</td>
                        <td scope="row">{{this.material_name}}</td>
                        <td scope="row">{{this.amount}}</td>
                        <td scope="row">{{this.sell_price}}</td>
                        <td scope="row">{{this.total_money}}</td>
                    </tr>
                    {{/each}}
                </tbody>
        </table>
            </div>

            <div class="bill__repair-info__table-wage">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Tên tiền công</th>
                            <th scope="col">Tiền công</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each DetailWage}}
                        <tr>
                            <td scope="row">{{this.wage_name}}</td>
                            <td scope="row">{{this.wage_money}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="bill__money-info">
            <div class="bill__money-info-detail">
                <div class="info-group">
                    <label for="">Tổng tiền:</label>
                    <label >8.700.600</label>
                </div>
                <div class="info-group">
                    <label for="">Thuế GTGT:</label>
                    <label >5%</label>
                </div>
                <div class="info-group">
                    <label for="">Số tiền đã trả:</label>
                    <label >0</label>
                </div>
                <div class="info-group">
                    <label for="">Tổng tiền thanh toán:</label>
                    <label >8.700.600</label>
                </div>
            </div>
        </div>
        <div class="bill__footer">
            <button class="btn-debt btn btn-danger" data-id="{{Reception._id}}">Ghi nợ</button>
            <button class="btn-print btn btn-success">In hóa đơn</button>
            <button class="btn-pay btn btn-primary" data-id="{{Reception._id}}" 
                data-toggle="modal" 
                data-target="#form-accept-pay">Thanh toán</button>
        </div>
    </div>
</div>
</div>
<form method="POST" name="modal-accept-pay" action="">
    <div class="modal fade" id="form-accept-pay" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLabel">Thanh toán</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body modal-body-descreption">
            Bạn có chắc chắn muốn thanh toán!!!
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn--close-dialog" data-dismiss="modal">Đóng</button>
            <button id="btn-accept-pay" type="button" class="btn btn--send-dialog">Đồng ý</button>
            </div>
        </div>
        </div>
    </div>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var btnAcceptPay = document.querySelector('#btn-accept-pay')
        var btnPrint = document.querySelector('#btn-print')
        var btnDebt = document.querySelector('#btn-debt')
        var formAccepPay = document.forms['modal-accept-pay']
        var receptionId
        $('#form-accept-pay').on('show.bs.modal' , function(event) {
            var button = $(event.relatedTarget)
            receptionId = button.data('id')
            console.log(receptionId)
        })
        
        btnAcceptPay.onclick = function() {
            formAccepPay.action = '/reception/' + receptionId + '/create-bill'
            formAccepPay.submit()
        }
    })
</script>