<link rel="stylesheet" href="./css/base.css">
<link rel="stylesheet" href="./css/brand.css">


<div class="grid__content">
  <div class="header__breadcrumb">
    <div class="header__breadcrumb-main">Quản lý hiệu xe</div>
  </div>

  <div class="toolbar">
      <div class="toolbar__search">
        <input type="text" class="toolbar__search-input" id="search-input" placeholder="Tìm kiếm thông tin xe...">
        <span class="ti-search toolbar__search-icon"> </span>
      </div>
      <div class="toolbar__btn">
          <button class="toolbar__btn-add btn btn-primary" data-toggle="modal" data-target="#modal-add">Thêm hiệu xe</button>
      </div>
  </div>
  {{!-- THÊM --}}
  <table class="table">
    <colgroup>
      <col>
      <col>
      <col>
    </colgroup>
    <thead class="thead-dark">
      <tr>
        <th scope="col">Mã hiệu xe</th>
        <th scope="col">Tên hiệu xe</th>
        <th scope="col" colspan="2"></th>
      </tr>
    </thead>
      <tbody>
        {{#each brands}}
        <tr>
          {{!-- 1 hiệu xe --}}
          <td>{{this._id}}</td>
          <td>{{this.name}}</td>
          <td class="row-btn">
            <button class="btn btn--edit-item btn-edit" data-id="{{this._id}}" 
            data-name="{{this.name}}" data-toggle="modal" data-target="#modal-edit">Sửa</button>
            <button class="btn btn--delete-item btn-delete" data-id="{{this._id}}" 
            data-target="#modal-delete" data-toggle="modal">Xóa</button>
          </td>
        </tr>
        {{/each}}
      </tbody>
  </table>
</div>

<form method="POST" action="/brand/create" id="form-add" name="form-add">
  <div class="modal fade" id="modal-add" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thêm phiếu sửa chữa</h5>
          <button type="button reception__form-btn-close" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="input-name">Tên hiệu xe</label>
              <input type="text" class="form-control" id="input-name" placeholder="" name="name">
              <span class="form-message"></span>
            </div>  
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn--close-dialog" data-dismiss="modal">Đóng</button>
          <button type="submit" class="btn btn--send-dialog">Thêm</button>
        </div>
      </div>
    </div>
  </div>
</form>
{{!-- FORM DELETE --}}
<form name="form-delete" method="POST">
<div class="modal fade" id="modal-delete" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="exampleModalLabel">Xóa hiệu xe</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body modal-body-descreption">
          Bạn có chắc chắn muốn xóa hiệu xe này!!!
        </div>
        <div class="modal-footer">
          <button id="btn-accept-delete" type="button" class="btn btn--delete-dialog">Xóa</button>
          <button type="button" class="btn btn--close-dialog" data-dismiss="modal">Đóng</button>
        </div>
      </div>
    </div>
  </div>
</form>
{{!-- FORM SUA --}}
<form name="form-edit" method="POST" action="" id="form-edit">
  <div class="modal fade" id="modal-edit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Thêm vật tư</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="form-edit-name" class="col-form-label">Hiệu xe:</label>
              <input type="text" class="form-control" id="form-edit-name" name="name">
              <span class="form-message"></span>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn--close-dialog" data-dismiss="modal">Đóng</button>
          <button id="btn-accept-edit" type="submit" class="btn--send-dialog">Sửa</button>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const formAdd = document.forms['form-add']
    Validator({
      form: '#form-add', // id của cái form cần validate
      errorSelector: '.form-message', // tên class để hiện cái lỗi
      rules: [
        Validator.isRequire('#input-name', 'Vui lòng nhập tên hiệu xe'),
      ],
      onSubmit: function() {
          formAdd.action = 'brand/create' 
          formAdd.submit()
        }
      })
      const formEdit = document.forms['form-edit']
      Validator({
        form: '#form-edit', // id của cái form cần validate
        errorSelector: '.form-message', // tên class để hiện cái lỗi
        rules: [
          Validator.isRequire('#form-edit-name', 'Vui lòng nhập tên hiệu xe'),
        ],
        onSubmit: function() {
            formEdit.action = 'brand/' + brandId + '/edit?_method=PUT'
            formEdit.submit()
          }
        })

    var brandId;
    var tdActive;
    var btnDelete = $('.btn-delete')
    var btnAcceptEdit = $('#btn-accept-edit')
    var btnEdit = $('.btn-edit')
    var inputEditName = document.querySelector('#form-edit-name')
    const btnAcceptDelete = document.querySelector('#btn-accept-delete')
    const formDelete = document.forms['form-delete']

    $('#form-edit').on('shown.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        brandId = button.data('id')
    })
    btnEdit.click(function(){
      var row = $(this).parents('tr')[0]
      $('#form-edit-name').val(row.cells[1].textContent)
    })

    $('#modal-delete').on('shown.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        brandId = button.data('id')
    })

    btnAcceptDelete.onclick = function() {
      formDelete.action = 'brand/' + brandId + '/delete?_method=DELETE'
      formDelete.submit()
    }
  })
</script>